{% extends "users/after_login_base.html" %}
{% load static %}

{% block specific_css_block %}
    <link rel="stylesheet" type="text/css" href="{% static 'jobs/css/styles.css' %}">
{% endblock specific_css_block %}

{% block main_content %}
<form method="post" class="border rounded-5 p-4 mx-auto bg-light mt-4 mb-3" style="max-width: 800px;">
    {% csrf_token %}
    <div class="h2 mb-4 text-center display-2">New Job Application</div>
    <div class="container-lg border rounded-5 p-4 bg-white mb-2">
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="{{ form.job_name.id_for_label }}" class="form-label">Job Title</label>
                <input type="text" name="job_name" id="id_job_name" class="form-control">
            </div>
            <div class="col-md-6">
                <label for="{{ form.company.id_for_label }}" class="form-label">Company Name</label>
                <input type="text" name="company" id="id_company" class="form-control">
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="{{ form.country.id_for_label }}" class="form-label">Country</label>
                <input type="text" name="country" id="id_country" class="form-control" value="{{ form.country.initial }}">
            </div>
            <div class="col-md-6">
                <label for="{{ form.city.id_for_label }}" class="form-label">City</label>
                <input type="text" name="city" id="id_city" class="form-control" value="{{ form.city.initial }}">
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="{{ form.apply_date.id_for_label }}" class="form-label">Application Date</label>
                <input type="date" name="apply_date" id="id_apply_date" class="form-control" value="{{ form.apply_date.initial|date:'Y-m-d' }}">
            </div>
            <div class="col-md-3">
                <label for="{{ form.city.id_for_label }}" class="form-label">Job Offer Valid To</label>
                <input type="date" name="valid_to" id="id_valid_to" class="form-control">
            </div>
            <div class="col-md-6">
                <label for="{{ form.link.id_for_label }}" class="form-label">Link</label>
                <input type="url" name="link" id="link" class="form-control">
            </div>
        </div>
        
        <div class="row mb-3 justify-content-center">
            <div class="col-md-3">
                <label for="{{ form.status.id_for_label }}" class="form-label">Application Status</label>
                <select name="status" id="id_status" class="form-select">
                    {% for value, label in form.status.field.choices %}
                        <option value="{{ value }}" {% if form.status.value == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="{{ form.portal.id_for_label }}" class="form-label">Portal</label>
                <input type="text" name="portal" id="portal" class="form-control">
            </div>
        </div>

    </div>

    <div class="d-flex align-items-center justify-content-between mb-2 toggle-details" 
        data-bs-toggle="collapse" href="#collapseExample" role="button" 
        aria-expanded="false" aria-controls="collapseExample" id="toggleDetails">
        <span>
            <i id="arrowIcon" class="bi bi-caret-right"></i>
            Add details
        </span>
        <hr class="flex-grow-1 ms-2 my-0">
    </div>
    
    <div class="collapse" id="collapseExample">
        <div class="container-lg border rounded-5 p-4 bg-white mb-2">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="{{ form.job_application_body.id_for_label }}" class="form-label">Job Description</label>
                    <textarea name="job_application_body" cols="30" rows="5" id="id_job_application_body" class="form-control"></textarea>
                </div>
                <div class="col-md-6">
                    <label for="{{ form.comments.id_for_label }}" class="form-label">Comments</label>
                    <textarea name="comments" cols="30" rows="5" id="id_comments" class="form-control"></textarea>
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Resume</label>
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle text-truncate w-100" type="button" id="resumeDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Select resume
                        </button>
                        <ul class="dropdown-menu w-100" aria-labelledby="resumeDropdown">
                            <li>
                                <a class="dropdown-item" href="#" id="uploadNewResume">âž• Upload new resume</a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            {% for r in resumes %}
                            <li>
                                <a class="dropdown-item resume-item" href="#" data-id="{{ r.id }}">{{ r.file_name }}</a>
                            </li>
                            {% endfor %}
                        </ul>
                        <input type="hidden" name="resume" id="resumeInput">
                        {{ second_form.new_resume }}
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="{{ form.salary_range.id_for_label }}" class="form-label">Salary Range</label>
                    <input type="text" name="salary_range" id="id_salary_range" class="form-control">
                </div>
            </div>
        </div>
    </div>
    <br>
    <div class="d-flex gap-2 mb-3 justify-content-center">
        <button type="submit" class="btn btn-primary btn-lg">Submit</button>
    </div>
</form>

<script src="{% static 'js/collapse_container.js' %}"></script>
{% endblock main_content %}